---
driver:
  name: vagrant
  customize:
    memory: 2048
    cpus: 2

provisioner:
  name: chef_solo
  product_name: chef
  enforce_idempotency: true
  multiple_converge: 2
  deprecations_as_errors: true

verifier:
  name: inspec

platforms:
  - name: amazonlinux-2
  - name: debian-9
  - name: debian-10
  - name: centos-7
  - name: fedora-latest
  - name: ubuntu-16.04
  - name: ubuntu-18.04

suites:

  ###############################
  # docker_installation resources
  ###############################
  - name: installation_script_main
    includes: [
      'ubuntu-16.04',
      'ubuntu-18.04'
    ]
    attributes:
      docker:
        repo: 'main'
    run_list:
      - recipe[docker_test::installation_script]

  - name: installation_script_test
    includes: [
      'ubuntu-16.04',
      'ubuntu-18.04'
    ]
    attributes:
      docker:
        repo: 'test'
    run_list:
      - recipe[docker_test::installation_script]

  - name: installation_script_experimental
    includes: [
      'ubuntu-16.04',
      'ubuntu-18.04'
    ]
    attributes:
      docker:
        repo: 'experimental'
    run_list:
      - recipe[docker_test::installation_script]

  - name: installation_package
    attributes:
      docker:
        version: '19.03.8'
    run_list:
      - recipe[docker_test::installation_package]
    excludes: ['amazonlinux-2']

  - name: installation_tarball
    attributes:
      docker:
        version: '19.03.8'
    run_list:
      - recipe[docker_test::installation_tarball]
    includes: [
      'ubuntu-16.04',
      'ubuntu-18.04'
    ]

  ##################
  # resource testing
  ##################

  - name: resources
    provisioner:
      enforce_idempotency: false
      multiple_converge: 1
    attributes:
      docker:
        version: '19.03.8'
    run_list:
      - recipe[docker_test::default]
      - recipe[docker_test::image]
      - recipe[docker_test::container]
      - recipe[docker_test::exec]
      - recipe[docker_test::plugin]

  - name: network
    includes: [
      'ubuntu-18.04',
    ]
    attributes:
      docker:
        version: '19.03.8'
    run_list:
      - recipe[docker_test::default]
      - recipe[docker_test::network]

  - name: volume
    includes: [
      'ubuntu-18.04',
    ]
    attributes:
      docker:
        version: '19.03.8'
    run_list:
      - recipe[docker_test::default]
      - recipe[docker_test::volume]

  - name: registry
    includes: [
      'ubuntu-18.04',
    ]
    attributes:
      docker:
        version: '19.03.8'
    run_list:
      - recipe[docker_test::default]
      - recipe[docker_test::registry]

  #############################
  # quick service smoke testing
  #############################

  - name: smoke
    includes: [
      'ubuntu-16.04',
      'ubuntu-18.04'
    ]
    run_list:
      - recipe[docker_test::smoke]
